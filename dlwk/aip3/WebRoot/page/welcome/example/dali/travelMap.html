<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>大理旅客分布图</title>
<script type="text/javascript" src="echarts3.5.0/echarts.min.js"></script>
<script type="text/javascript" src="echarts3.5.0/map-china.js"></script>
</head>
<body>
    <div id="dlmap" style="width: 800px;height: 540px;margin: auto;"></div>
    <script type="text/javascript">
        
    	var dlmap=echarts.init(document.getElementById("dlmap"));
    	var geoCoordMapCity = {
				'上海': [121.4648,31.2891],
				'东莞': [113.8953,22.901],
				'东营': [118.7073,37.5513],
				'中山': [113.4229,22.478],
				'临汾': [111.4783,36.1615],
				'临沂': [118.3118,35.2936],
				'丹东': [124.541,40.4242],
				'丽水': [119.5642,28.1854],
				'乌鲁木齐': [87.9236,43.5883],
				'佛山': [112.8955,23.1097],
				'保定': [115.0488,39.0948],
				'兰州': [103.5901,36.3043],
				'包头': [110.3467,41.4899],
				'北京': [116.4551,40.2539],
				'北海': [109.314,21.6211],
				'南京': [118.8062,31.9208],
				'南宁': [108.479,23.1152],
				'南昌': [116.0046,28.6633],
				'南通': [121.1023,32.1625],
				'厦门': [118.1689,24.6478],
				'台州': [121.1353,28.6688],
				'合肥': [117.29,32.0581],
				'呼和浩特': [111.4124,40.4901],
				'咸阳': [108.4131,34.8706],
				'哈尔滨': [127.9688,45.368],
				'唐山': [118.4766,39.6826],
				'嘉兴': [120.9155,30.6354],
				'大同': [113.7854,39.8035],
				'大连': [122.2229,39.4409],
				'天津': [117.4219,39.4189],
				'太原': [112.3352,37.9413],
				'威海': [121.9482,37.1393],
				'宁波': [121.5967,29.6466],
				'宝鸡': [107.1826,34.3433],
				'宿迁': [118.5535,33.7775],
				'常州': [119.4543,31.5582],
				'广州': [113.5107,23.2196],
				'廊坊': [116.521,39.0509],
				'延安': [109.1052,36.4252],
				'张家口': [115.1477,40.8527],
				'徐州': [117.5208,34.3268],
				'德州': [116.6858,37.2107],
				'惠州': [114.6204,23.1647],
				'成都': [103.9526,30.7617],
				'扬州': [119.4653,32.8162],
				'承德': [117.5757,41.4075],
				'拉萨': [91.1865,30.1465],
				'无锡': [120.3442,31.5527],
				'日照': [119.2786,35.5023],
				'昆明': [102.9199,25.4663],
				'杭州': [119.5313,29.8773],
				'枣庄': [117.323,34.8926],
				'柳州': [109.3799,24.9774],
				'株洲': [113.5327,27.0319],
				'武汉': [114.3896,30.6628],
				'汕头': [117.1692,23.3405],
				'江门': [112.6318,22.1484],
				'沈阳': [123.1238,42.1216],
				'沧州': [116.8286,38.2104],
				'河源': [114.917,23.9722],
				'泉州': [118.3228,25.1147],
				'泰安': [117.0264,36.0516],
				'泰州': [120.0586,32.5525],
				'济南': [117.1582,36.8701],
				'济宁': [116.8286,35.3375],
				'海口': [110.3893,19.8516],
				'淄博': [118.0371,36.6064],
				'淮安': [118.927,33.4039],
				'深圳': [114.5435,22.5439],
				'清远': [112.9175,24.3292],
				'温州': [120.498,27.8119],
				'渭南': [109.7864,35.0299],
				'湖州': [119.8608,30.7782],
				'湘潭': [112.5439,27.7075],
				'滨州': [117.8174,37.4963],
				'潍坊': [119.0918,36.524],
				'烟台': [120.7397,37.5128],
				'玉溪': [101.9312,23.8898],
				'珠海': [113.7305,22.1155],
				'盐城': [120.2234,33.5577],
				'盘锦': [121.9482,41.0449],
				'石家庄': [114.4995,38.1006],
				'福州': [119.4543,25.9222],
				'秦皇岛': [119.2126,40.0232],
				'绍兴': [120.564,29.7565],
				'聊城': [115.9167,36.4032],
				'肇庆': [112.1265,23.5822],
				'舟山': [122.2559,30.2234],
				'苏州': [120.6519,31.3989],
				'莱芜': [117.6526,36.2714],
				'菏泽': [115.6201,35.2057],
				'营口': [122.4316,40.4297],
				'葫芦岛': [120.1575,40.578],
				'衡水': [115.8838,37.7161],
				'衢州': [118.6853,28.8666],
				'西宁': [101.4038,36.8207],
				'西安': [109.1162,34.2004],
				'贵阳': [106.6992,26.7682],
				'连云港': [119.1248,34.552],
				'邢台': [114.8071,37.2821],
				'邯郸': [114.4775,36.535],
				'郑州': [113.4668,34.6234],
				'鄂尔多斯': [108.9734,39.2487],
				'重庆': [107.7539,30.1904],
				'金华': [120.0037,29.1028],
				'铜川': [109.0393,35.1947],
				'银川': [106.3586,38.1775],
				'镇江': [119.4763,31.9702],
				'长春': [125.8154,44.2584],
				'长沙': [113.0823,28.2568],
				'长治': [112.8625,36.4746],
				'阳泉': [113.4778,38.0951],
				'青岛': [120.4651,36.3373],
				'韶关': [113.7964,24.7028],
				'大理白族自治州':[100.225668,25.589449]
			};
		var geoCoordMapProvince={
				"台湾":[121.509062,25.044332],
				"河北":[114.502461,38.045474],
				"山西":[112.549248,37.857014],
				"内蒙古":[111.670801,40.818311],
				"辽宁":[123.429096,41.796767],
				"吉林":[125.3245,43.886841],
				"黑龙江":[126.642464,45.756967],
				"江苏":[118.767413,32.041544],
				"浙江":[120.153576,30.287459],
				"安徽":[117.283042,31.86119],
				"福建":[119.306239,26.075302],
				"江西":[115.892151,28.676493],
				"山东":[117.000923,36.675807],
				"河南":[113.665412,34.757975],
				"湖北":[114.298572,30.584355],
				"湖南":[112.982279,28.19409],
				"广东":[113.280637,23.125178],
				"广西":[108.320004,22.82402],
				"海南":[110.33119,20.031971],
				"四川":[104.065735,30.659462],
				"贵州":[106.713478,26.578343],
				"云南":[102.712251,25.040609],
				"西藏":[91.132212,29.660361],
				"陕西":[108.948024,34.263161],
				"甘肃":[103.823557,36.058039],
				"青海":[101.778916,36.623178],
				"宁夏":[106.278179,38.46637],
				"新疆":[87.617733,43.792818],
				"北京":[116.405285,39.904989],
				"天津":[117.190182,39.125596],
				"上海":[121.472644,31.231706],
				"重庆":[106.504962,29.533155],
				"香港":[114.173355,22.320048],
				"澳门":[113.54909,22.198951]
				};
    	var dlData=[
		    {name:'青海',value:	73586	},
    		{name:'广西',value:	422735	},
    		{name:'重庆',value:	355305	},
    		{name:'安徽',value:	429459	},
    		{name:'北京',value:	331029	},
    		{name:'河南',value:	747657	},
    		{name:'湖北',value:	699217	},
    		{name:'陕西',value:	529876	},
    		{name:'贵州',value:	562765	},
    		{name:'山东',value:	529580	},
    		{name:'黑龙江',value:	379483	},
    		{name:'新疆',value:	147140	},
    		{name:'海南',value:	53122	},
    		{name:'宁夏',value:	63375	},
    		{name:'吉林',value:	239624	},
    		{name:'福建',value:	340852	},
    		{name:'西藏',value:	55175	},
    		{name:'云南',value:	7541147	},
    		{name:'四川',value:	2512985	},
    		{name:'浙江',value:	572139	},
    		{name:'上海',value:	280063	},
    		{name:'广东',value:	1001009	},
    		{name:'河北',value:	469194	},
    		{name:'江苏',value:	610915	},
    		{name:'江西',value:	394785	},
    		{name:'湖南',value:	829250	},
    		{name:'辽宁',value:	383210	},
    		{name:'内蒙古',value:	186545	},
    		{name:'甘肃',value:	240948	},
    		{name:'天津',value:	131825	},
    		{name:'山西',value:	344432	}
			];
		
		var inDlData = [
		    {dfrom:'青海',dto:'大理白族自治州',value:73586},
			{dfrom:'广西',dto:'大理白族自治州',value:422735},
			{dfrom:'重庆',dto:'大理白族自治州',value:355305},
			{dfrom:'安徽',dto:'大理白族自治州',value:429459},
			{dfrom:'北京',dto:'大理白族自治州',value:331029},
			{dfrom:'河南',dto:'大理白族自治州',value:747657},
			{dfrom:'湖北',dto:'大理白族自治州',value:699217},
			{dfrom:'陕西',dto:'大理白族自治州',value:529876},
			{dfrom:'贵州',dto:'大理白族自治州',value:562765},
			{dfrom:'山东',dto:'大理白族自治州',value:529580},
			{dfrom:'黑龙江',dto:'大理白族自治州',value:379483},
			{dfrom:'新疆',dto:'大理白族自治州',value:147140},
			{dfrom:'海南',dto:'大理白族自治州',value:53122},
			{dfrom:'宁夏',dto:'大理白族自治州',value:63375},
			{dfrom:'吉林',dto:'大理白族自治州',value:239624},
			{dfrom:'福建',dto:'大理白族自治州',value:340852},
			{dfrom:'西藏',dto:'大理白族自治州',value:55175},
			{dfrom:'云南',dto:'大理白族自治州',value:7541147},
			{dfrom:'四川',dto:'大理白族自治州',value:2512985},
			{dfrom:'浙江',dto:'大理白族自治州',value:572139},
			{dfrom:'上海',dto:'大理白族自治州',value:280063},
			{dfrom:'广东',dto:'大理白族自治州',value:1001009},
			{dfrom:'河北',dto:'大理白族自治州',value:469194},
			{dfrom:'江苏',dto:'大理白族自治州',value:610915},
			{dfrom:'江西',dto:'大理白族自治州',value:394785},
			{dfrom:'湖南',dto:'大理白族自治州',value:829250},
			{dfrom:'辽宁',dto:'大理白族自治州',value:383210},
			{dfrom:'内蒙古',dto:'大理白族自治州',value:186545},
			{dfrom:'甘肃',dto:'大理白族自治州',value:240948},
			{dfrom:'天津',dto:'大理白族自治州',value:131825},
			{dfrom:'山西',dto:'大理白族自治州',value:344432}
		];	
		var mapName="大理旅客";
    	dlmap.setOption({
		   // backgroundColor: '#404a59',
    	    title: {
    	        text: '大理旅客分布图',
    	        subtext: '',
    	        left: 'center'
    	    },
    	    tooltip: {
    	        trigger: 'item',
    	        formatter:
				    //"{a}<br/>{b}:{c}人"
					function(params,ticket)
					{
						var str="";
						str+=params.seriesName+"<br/>";
						str+=params.name+"：";
						str+=(params.value?formatNuber(params.value):0)+"人";
						return str;
					}
    	    },
    	    visualMap: {
    	        min: 0,
    	        max: 1000000,
    	        left: 'right',
    	        top: 'top',
    	        text: ['高','低'],           // 文本，默认为数值文本
    	        calculable: true,
				seriesIndex:[0],
				inRange: {
					//color: ['#e0ffff', '#006edd','#C00000']
					color: ['#e0ffff', '#006edd']
				}
    	    },
			geo: {
				map: 'china',
				label: {
    	                normal: {
    	                    show: true
    	                },
    	                emphasis: {
    	                    show: true
    	                }
    	            },
				zoom:1.2,
				scaleLimit:
				{
					min:1,
					max:4
				},
				roam: true
			},
    	    series: [
				{
					name: mapName,
					type: 'map',
					geoIndex: 0,
					// tooltip: {show: false},
					data:dlData,
					zlevel: 1,
				},
				{
					name: mapName,
					type: 'lines',
					tooltip: {show: false},
					zlevel: 2,
					effect: {
						show: true,
						period: 6,
						trailLength: 0.7,
						color: '#ffffff',
						symbolSize: 3
					},
					lineStyle: {
						normal: {
							color: '#a6c84c',
							width: 0,
							curveness: 0.2
						}
					},
					data: convertData(inDlData)
				},
                {
					name: mapName,
					type: 'lines',
					tooltip: {show: false},
					zlevel: 3,
					symbol: ['none', 'arrow'],
					symbolSize: 10,
					effect: {
						show: true,
						period: 6,
						trailLength: 0,
						//symbol: planePath,
						symbolSize: 6
					},
					lineStyle: {
						normal: {
							color: '#a6c84c',
							width: 1,
							opacity: 0.6,
							curveness: 0.2
						}
					},
					data: convertData(inDlData)
				},
                {
					name: mapName,
					type: 'effectScatter',
					tooltip: {show: false},
					coordinateSystem: 'geo',
					zlevel: 4,
					rippleEffect: {
						brushType: 'stroke'
					},
					label: {
						normal: {
							show: false,
							position: 'right',
							formatter: '{b}'
						}
					},
					symbolSize: function (val) {
					     var size=10;
						 size=val[2] / 40000;
						 if(size<5)
						 {
							size=5;
						 }
						 else if(size>20)
						 {
							size=20;
						 }
						return size;
					},
					itemStyle: {
						normal: {
							color: '#F06C00',
							opacity: 0.8,
						}
					},
					data: inDlData.map(function (dataItem) {
						return {
							name: dataItem.dfrom,
							value: getGeoCoordByName(dataItem.dfrom).concat([dataItem.value])
						};
					})
				}				
    	    ]
    	});
    	
		function convertData(data) {
			var res = [];
			for (var i = 0; i < data.length; i++) {
				var dataItem = data[i];
				var fromCoord = getGeoCoordByName(dataItem.dfrom);
				var toCoord = getGeoCoordByName(dataItem.dto);
				if (fromCoord && toCoord) {
					res.push({
						fromName: dataItem.dfrom,
						toName: dataItem.dto,
						coords: [fromCoord, toCoord]
					});
				}
			}
			return res;
		};
    	
		function getGeoCoordByName(geoName)
		{
			var coord=geoCoordMapCity[geoName];
			if(!coord)
			{
				coord=geoCoordMapProvince[geoName];
			}
			
			return coord;
		}
		
		function printMapGeo()
		{
			var map=echarts.getMap("china");
			var features=map.geoJson.features;
			for(var i=0;i<features.length;i++)
			{
				var f=features[i];
				geoCoordMapProvince[f.properties.name]=f.properties.cp;
			}
			console.log(JSON.stringify(geoCoordMapProvince));
		}
		
		function formatNuber(n)   
		{    
			n=n+"";
		　　n=n.replace(/\d{1,3}(?=(\d{3})+(\.\d*)?$)/g, '$&,')
		　　return n;
		}
		//printMapGeo();
    </script>
</body>
</html>